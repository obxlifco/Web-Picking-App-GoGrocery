<div class="container">
    <div>
        <h4>Order Details</h4>
    </div>
    <div class="row">
        <div class="form-group">
            <label for="orderby">Order prepared by</label>
            <input type="text" [disabled]="userOrderdata.picker_name" #username [value]="userOrderdata.picker_name"
                (keyup.enter)="AssaignorderToUser(username.value)" class="form-control" placeholder="Order prepared by"
                id="orderby">
        </div>
    </div>
    <div class="row">
        <div class="col-xs-6 col-sm-6 col-md-8 col-lg-8 grid-margin">
            <div style="width: 100%;">
                <table class="table table-data">
                    <tr>
                        <td>Order No : </td>
                        <td>{{orderDetaildata['data'][0]?.custom_order_id}}</td>
                    </tr>
                    <tr>
                        <td>Order Status :</td>
                        <td>
                            <span style="color: green;"
                                *ngIf="orderDetaildata['data'][0]?.order_status === 100 && userOrderdata.substitute_status === 'none'">Assigned</span>
                            <span style="color: red;" *ngIf="orderDetaildata['data'][0]?.order_status === 0">New</span>
                            <span style="color: 	#00CED1;"
                                *ngIf="orderDetaildata['data'][0]?.order_status === 100 && userOrderdata.substitute_status === 'pending'">Subs.Out</span>
                            <span style="color: #00008B;"
                                *ngIf="orderDetaildata['data'][0]?.order_status === 100 && userOrderdata.substitute_status === 'done'">Subs.In
                            </span>
                            <span style="color:gray;"
                                *ngIf="orderDetaildata['data'][0]?.order_status === 1 && orderDetaildata['data'][0]?.order_shipment.shipment_status === 'Shipped'">Shipped
                            </span>

                        </td>
                    </tr>
                    <tr>
                        <td>Bill Number :</td>
                        <td>
                            <!-- <div (click)="BillnumberModal(orderDetaildata['data'][0]?.channel_order_id)"
                                *ngIf="orderDetaildata['data'][0]?.channel_order_id"
                                [disabled]="!userOrderdata.picker_name" class="colorclass"
                                [(ngModel)]="product_billnumber">
                                {{orderDetaildata['data'][0]?.channel_order_id}}
                            </div>
                            <p style="color: cyan;" *ngIf="!orderDetaildata['data'][0]?.channel_order_id"
                                (click)="BillnumberModal(product_billnumber)">
                                {{product_billnumber}}
                            </p> -->
                            <!-- <span style="color: cyan;" (click)="BillnumberComponent()" *ngIf="!orderDetaildata['data'][0]?.channel_order_id">Enter Bill Number</span> -->

                            <input #bnumber
                                [ngStyle]="{'border-color':product_billnumber === null ? 'gray' : customcolor }"
                                (click)="BillnumberModal(orderDetaildata['data'][0]?.channel_order_id)"
                                [disabled]="!userOrderdata.picker_name"
                                [value]="orderDetaildata['data'][0]?.channel_order_id" class="colorclass"
                                placeholder="Enter Bill Number" type="text" [(ngModel)]="product_billnumber"
                                class="form-control">
                        </td>
                    </tr>
                    <tr>
                        <td>Order date and time :</td>
                        <td>
                            {{orderDetaildata['data'][0]?.order_activity[0]?.activity_date | date:'d MMM, y, h:mm a' }}
                        </td>
                    </tr>
                    <tr>
                        <td>Customer Name :</td>
                        <td>{{orderDetaildata['data'][0]?.customer?.first_name}}
                            {{orderDetaildata['data'][0]?.customer?.last_name}}
                        </td>
                    </tr>
                    <tr>
                        <td>Mobile Number :</td>
                        <td>{{orderDetaildata['data'][0]?.customer?.phone}}</td>
                    </tr>
                    <tr>
                        <td>Delivery Address :</td>
                        <td>{{orderDetaildata['data'][0]?.delivery_street_address}}
                            {{orderDetaildata['data'][0]?.delivery_state_name}}
                            <br>
                            <div class="highlight_edits">
                                <strong style="color: white;cursor: pointer;"
                                    (click)="openmap(orderDetaildata['data'][0]?.customer_addressbook)">View in map
                                </strong>
                            </div>

                        </td>
                    </tr>
                    <tr>
                        <td style="padding: 8% 0% 0% 3%;">Deliver Time :</td>
                        <td>
                            <div class="highlight_edits">
                                <div style="color: white;">
                                    {{orderDetaildata['data'][0]?.time_slot_date | date : 'longDate'}}
                                    <mat-form-field appearance="fill">
                                        <!-- The timepicker input -->
                                        <input style="background-color:blue;color: white !important;"
                                            [disabled]="!userOrderdata.picker_name" matTimepicker #t="matTimepicker"
                                            #time="ngModel" [minDate]="minValue" [maxDate]="maxValue" [strict]="false"
                                            mode="24h" [value]="datetime" [ngModel]="datetime" [placeholder]="orderDetaildata['data'][0]?.slot_end_time"
                                            name="time" [errorStateMatcher]="customErrorStateMatcher"
                                            (timeChange)="timeChangeHandler($event,orderDetaildata['data'][0]?.slot_start_time)"
                                            (invalidInput)="invalidInputHandler()">
                                        <!-- An icon for the timepicker input that will open the timepicker dialog when clicked -->
                                        <mat-icon [disabled]="!userOrderdata.picker_name" matSuffix
                                            (click)="t.showDialog()">access_time</mat-icon>
                                        <!-- Error that will be shown when the input date is invalid -->
                                        <mat-error *ngIf="time.touched && time.invalid">Invalid Date</mat-error>
                                    </mat-form-field>
                                </div>
                            </div>

                        </td>
                    </tr>
                    <tr>
                        <td>Value of Products :</td>
                        <td>
                            <strong>
                                {{orderDetaildata['data'][0]?.currency_code}}
                                {{orderDetaildata['data'][0]?.net_amount}}
                            </strong>
                        </td>
                    </tr>
                    <tr>
                        <td>New Value of Products :</td>
                        <td>
                            <!-- <input [disabled]="!userOrderdata.picker_name" class="colorclass" placeholder="Enter Price"
                                type="text" class="form-control"> -->
                            <div class="highlight_edits">
                                <p *ngIf="!orderDetaildata['data'][0]?.order_net_amount && !price" class="newprice"
                                    (click)="updatePrice(orderDetaildata['data'][0]?.order_net_amount,orderDetaildata['data'][0]?.net_amount)">
                                    Enter Product price
                                </p>
                                <p *ngIf="price && !orderDetaildata['data'][0]?.order_net_amount" class="newprice"
                                    (click)="updatePrice(orderDetaildata['data'][0]?.order_net_amount,orderDetaildata['data'][0]?.net_amount)">
                                    {{price}}</p>
                                <div *ngIf="orderDetaildata['data'][0]?.order_net_amount || price"
                                    (click)="updatePrice(orderDetaildata['data'][0]?.order_net_amount,orderDetaildata['data'][0]?.net_amount)">
                                    <p>{{orderDetaildata['data'][0]?.order_net_amount}}</p>
                                </div>
                            </div>

                        </td>
                    </tr>
                    <tr>
                        <td>Shipping Charge :</td>
                        <td>{{orderDetaildata['data'][0]?.shipping_cost}}</td>
                    </tr>
                    <tr>
                        <td>Shipping Discount :</td>
                        <td><strong>{{orderDetaildata['data'][0]?.cart_discount}}</strong></td>
                    </tr>
                    <tr>
                        <td>Other Discount :</td>
                        <td><strong>{{orderDetaildata['data'][0]?.gross_discount_amount}}</strong></td>
                    </tr>
                    <mat-divider></mat-divider>
                    <tr>
                        <td>
                            <strong class="paymentfooter">Total Price</strong>
                        </td>
                        <td>
                            <strong class="paymentfooter">
                                {{orderDetaildata['data'][0]?.gross_amount}}
                            </strong>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <strong class="paymentfooter">Payment Method</strong>
                        </td>
                        <td>
                            <strong class="paymentfooter">
                                {{orderDetaildata['data'][0]?.payment_method_name}}
                            </strong>
                        </td>
                    </tr>
                    <!-- <mat-divider></mat-divider> -->
                </table>

                <!-- adding items -->
                <div class="add-items">
                    <div style="background: aliceblue;text-align: -webkit-center;width: 97%">
                        <h6>ITEMS</h6>
                        <mat-divider></mat-divider>
                    </div>
                    <!-- Add more button -->
                    <!-- <div class="row row-margin">
                        <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 stretch-card grid-margin"
                            style="display: block;">
                            <button [disabled]="!userOrderdata.picker_name"
                                (click)="openDialog('picker-productlist/','picker-addmoreproduct','Add New Product','',1,'','')"
                                type="button" class="btn btn-light">
                                <mat-icon>control_point</mat-icon>
                                Add More
                            </button>
                            <button [disabled]="!userOrderdata.picker_name" type="button" style="width: 98px;"
                                class="btn btn-light csv-btn">
                                <mat-icon style="left: 8%;">get_app</mat-icon> CSV
                            </button>
                        </div>
                    </div> -->
                </div>

                <div class="row substitute-container" style="margin-right: 0%;margin-left: 0px;">
                    <div class="col-xs-12  col-sm-12  col-md-12 col-lg-12 stretch-card grid-margin"
                        *ngFor="let products of orderDetaildata['data'][0]?.order_products, let i=index">
                        <!-- [ngStyle]="{'background-color':products?.quantity === 'UK' ? 'green' : 'red' }" -->
                        <div class="layover-root"
                            *ngIf="products?.quantity === products?.grn_quantity + products?.shortage">
                            <img src="assets/images/product/toggle_checked.png" alt="">
                            <div class="layover">
                            </div>
                        </div>
                        <table>
                            <tr>
                                <td style="width: 100px;">
                                    <img class="orderprod_img" style="width: 50%;" [src]="products?.product.product_images[0]?.link+''+products?.product.product_images[0]?.img" alt="">
                                </td>
                                <td style="line-height:2">
                                    <h6>{{products?.product.name}}</h6>
                                    <!-- <button (click)="openEditModal(products)" type="button" class="btn btn-danger">Edit
                                        Weight</button><br> -->
                                    <span>Unit Weight : {{products?.product.weight}}
                                        {{products?.product.uom.uom_name}}</span> <br>
                                    Total Weight : <strong>{{products?.product.weight * products?.quantity}}
                                        {{products?.product.uom.uom_name}}</strong><br>
                                    Unit Price :<strong>{{products?.product_price}}</strong><br>
                                    Total Price :
                                    <strong>{{products?.product_price *  products?.grn_quantity}}</strong><br>
                                    Ordered Qty :<strong>{{products?.quantity}}</strong><br>
                                    <div>

                                    </div>
                                    <div class="row row-margin">
                                        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 stretch-card grid-margin">

                                            <div>
                                                <strong>Available</strong>
                                                <div class="btn-left">
                                                    <mat-icon
                                                        (click)="productDecerment(products.grn_quantity,products.id,products.product.id,products.shortage,i,'','','','','')"
                                                        [disabled]="!userOrderdata.picker_name" class="left-icon">
                                                        minimize</mat-icon>
                                                    <!-- <input [(ngModel)]="item_available" type="text"
                                                        class="form-control"> -->
                                                    <input *ngIf="products?.grn_quantity"
                                                        [value]="products?.grn_quantity" type="text"
                                                        class="form-control">

                                                    <input *ngIf="!products?.grn_quantity" value="0" type="text"
                                                        class="form-control">

                                                    <mat-icon [disabled]="!userOrderdata.picker_name" class="right-icon"
                                                        (click)="productIncrment(products.grn_quantity,products.product.id,products.id,products.shortage,i,
                                                        '','','','','',products.product.ean)">
                                                        add</mat-icon>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 stretch-card grid-margin">
                                            <div>
                                                <strong>Not Available</strong>
                                                <div class="btn-right">
                                                    <mat-icon matRipple [disabled]="!userOrderdata.picker_name"
                                                        (click)="productDecerment(products.shortage,products.product.id,products.id,products.shortage,i,'picker-substituteproductlist/','picker-addsubstituteproduct','Add Subtitute Product',products?.id,2)"
                                                        class="left-icon" [disabled]="">
                                                        minimize</mat-icon>

                                                    <input *ngIf="products?.shortage" [value]="products?.shortage"
                                                        type="text" class="form-control">

                                                    <input *ngIf="!products?.shortage" value="0" type="text"
                                                        class="form-control">

                                                    <mat-icon matRipple [disabled]="!userOrderdata.picker_name" (click)="productIncrment(products.shortage,products.product.id,products.id,products.shortage,i,'picker-substituteproductlist/','picker-addsubstituteproduct','Add Subtitute Product',products?.id,2,products.product.ean)
                                                        " class="right-icon">add</mat-icon>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <!-- Approved products -->
                <div class="row substitute-container" style="margin-right: 0%;margin-left: 0px;">
                    <div class="col-xs-12  col-sm-12  col-md-12 col-lg-12 stretch-card grid-margin"
                        *ngFor="let subt_products of orderDetaildata['data'][0]?.order_substitute_products, let i=index">
                        <div *ngIf="subt_products?.send_approval === 'approve'">
                            <!-- [ngStyle]="{'background-color':products?.quantity === 'UK' ? 'green' : 'red' }" -->
                            <div class="layover-root"
                                *ngIf="subt_products?.quantity === subt_products?.grn_quantity + subt_products?.shortage">
                                <img src="assets/images/product/toggle_checked.png" alt="">
                                <div class="layover">
                                </div>
                            </div>
                            <table>
                                <tr>
                                    <td style="width: 100px;">
                                        <img style="width: 50%;" [src]="subt_products?.product.product_images[0]?.link+''+subt_products?.product.product_images[0]?.img"
                                            alt="">
                                        <button type="button" style="bottom: 4%;position: absolute;left: 2%;"
                                            class="btn btn-primary">Substitute</button>
                                    </td>
                                    <td style="line-height:2">
                                        <h6>{{subt_products?.product.name}}</h6>
                                        <button (click)="openEditModal(subt_products)" type="button"
                                            class="btn btn-danger">Edit
                                            Weight</button><br>
                                        <span>Unit Weight : {{subt_products?.product.weight}}
                                            {{subt_products?.product.uom.uom_name}}</span> <br>
                                        Total Weight :
                                        <strong>{{subt_products?.product.weight * subt_products?.quantity}}
                                            {{subt_products?.product.uom.uom_name}}</strong><br>
                                        Unit Price :<strong>{{subt_products?.product_price}}</strong><br>
                                        Total Price :
                                        <strong>{{subt_products?.product_price *  subt_products?.grn_quantity}}</strong><br>
                                        Ordered Qty :<strong>{{subt_products?.quantity}}</strong><br>
                                        <div>

                                        </div>
                                        <div class="row row-margin">
                                            <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 stretch-card">

                                                <div>
                                                    <strong>Available</strong>
                                                    <div class="btn-left">
                                                        <mat-icon
                                                            (click)="productDecerment(subt_products.grn_quantity,subt_products.id,subt_products.product.id,subt_products.shortage,i,'','','','','')"
                                                            [disabled]="!userOrderdata.picker_name" class="left-icon">
                                                            minimize</mat-icon>
                                                        <!-- <input [(ngModel)]="item_available" type="text"
                                                    class="form-control"> -->
                                                        <input *ngIf="subt_products?.grn_quantity"
                                                            [value]="subt_products?.grn_quantity" type="text"
                                                            class="form-control">

                                                        <input *ngIf="!subt_products?.grn_quantity" value="0"
                                                            type="text" class="form-control">

                                                        <mat-icon [disabled]="!userOrderdata.picker_name"
                                                            class="right-icon" (click)="productIncrment(subt_products.grn_quantity,subt_products.product.id,subt_products.id,subt_products.shortage,i,
                                                    '','','','','',subt_products.product.ean)">
                                                            add</mat-icon>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 stretch-card">
                                                <div>
                                                    <strong>Not Available</strong>
                                                    <div class="btn-right">
                                                        <mat-icon matRipple [disabled]="!userOrderdata.picker_name"
                                                            (click)="productDecerment(subt_products.shortage,subt_products.product.id,subt_products.id,subt_products.shortage,i,'picker-substituteproductlist/','picker-addsubstituteproduct','Add Subtitute Product',subt_products?.id,2)"
                                                            class="left-icon" [disabled]="">
                                                            minimize</mat-icon>

                                                        <input *ngIf="subt_products?.shortage"
                                                            [value]="subt_products?.shortage" type="text"
                                                            class="form-control">

                                                        <input *ngIf="!subt_products?.shortage" value="0" type="text"
                                                            class="form-control">

                                                        <mat-icon matRipple [disabled]="!userOrderdata.picker_name"
                                                            (click)="productIncrment(subt_products.shortage,subt_products.product.id,subt_products.id,subt_products.shortage,i,'picker-substituteproductlist/','picker-addsubstituteproduct','Add Subtitute Product',subt_products?.id,2,subt_products.product.ean)
                                                    " class="right-icon">add</mat-icon>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                            <!-- end loop -->
                            <!-- <div  *ngIf="subt_products?.send_approval === 'approve' && i === 0">
                    <p>Replacement request has been approved by the customer</p>
                </div> -->
                        </div>

                    </div>
                </div>
                <!-- substitute product -->
                <div *ngIf="!IS_Subtitute">
                    <div class="subtitute_data" *ngIf="orderDetaildata['data'][0]?.order_substitute_products.length">
                        <div class="alert alert-info">
                            <h3>Subtitute Product</h3>
                        </div>
                        <div *ngFor="let subtitute of orderDetaildata['data'][0]?.order_substitute_products">
                            <div class="row"
                                *ngIf="subtitute.send_approval !== 'declined'&& subtitute.send_approval !=='approve'">
                                <div class="col-xs-2 col-sm-2 col-md-2 col-lg-2 stretch-card grid-margin">
                                    <img [src]="subtitute?.product.product_images[0]?.link+''+subtitute?.product.product_images[0]?.img"  alt="">
                                </div>
                                <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                                    <strong style="color: green;">{{subtitute?.product.name}}</strong><br>
                                    <div>Price:<strong>{{orderDetaildata['data'][0]?.currency_code}}
                                            {{subtitute.product_price}}</strong></div>
                                    <!-- <strong>Available</strong> -->
                                </div>
                                <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
                                    <span>{{subtitute.product.weight}} {{subtitute.product.uom.uom_name}}</span>
                                </div>
                            </div>
                        </div>
                        <button type="button" style="width: 100%;"
                            (click)="sendProductSubtituteApproval(orderDetaildata['data'][0]?.order_substitute_products,orderDetaildata['data'][0]?.channel_order_id,product_billnumber)"
                            class="btn btn-success">Send for Approval
                            <countdown *ngIf="IsTimeComplete === true" [config]="{leftTime: 0.1*60, notify: [ 2, 5 ]}"
                                (event)="handleEvent($event)">
                            </countdown>
                        </button><br>
                        <button *ngIf="IsTimeComplete === false" [disabled]="!userOrderdata.picker_name" type="button"
                            (click)="declinedProduct()" class="btn btn-success declinedbtn">Declined Product
                        </button>
                        <p style="text-align: center;" *ngIf="!IsTimeComplete">
                            <strong>Send Replacement request to customer for approval</strong><br>
                            <span>please wait for cutomer cofirmation for 10 min</span>
                        </p>
                    </div>
                </div>
                <!-- process order -->
                <div class="row" *ngIf="IS_Subtitute === true">
                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12 stretch-card grid-margin btnpadding">
                        <button [disabled]="!userOrderdata.picker_name" style="width: 100%;" type="button"
                            (click)="processOrder()" class="btn btn-success">Process the order</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xs-6 col-sm-6  col-md-4  col-lg-4 grid-margin col-right">
            <!-- <table class="table">
        <th>Order Status</th>
        <tr>
            <td>Ordered On : </td>
            <td></td>
        </tr>
        <tr>
            <td>Delivery Address :</td>
            <td></td>
        </tr>
        <tr>
            <td>This order is assaign to :</td>
            <td></td>
        </tr>
        <tr>
            <td>Price :</td>
            <td></td>
        </tr>
        <tr>
            <td>Payment status :</td>
            <td></td>
        </tr>
        </table> -->
            <div class="orderlist-heading">
                <h4>Order List</h4>
                <!-- msInfiniteScroll (infiniteScroll)="getNextData()" threshold="15%" -->
                <cdk-virtual-scroll-viewport itemSize="50" minBufferPx="200" maxBufferPx="400" class="scroll-viewport">
                    <div *cdkVirtualFor="let order of orderlistdata['data']?.response" class="scroll-inner-data" >
                        <mat-card class="orderlist-card"
                            (click)="getOrderDetailData(order.id,order.shipment_id,order.order_status,order.picker_name,order.substitute_status)">
                            <mat-card-header *ngIf="order?.order_status === 0" style="background-color: red;">
                                <mat-card-title>{{order?.custom_order_id}} New</mat-card-title>
                            </mat-card-header>
                            <mat-card-header style="background-color: green;"
                                *ngIf="order?.order_status === 100 && order?.substitute_status === 'none'">
                                <mat-card-title>{{order?.custom_order_id}} Assigned
                                </mat-card-title>
                            </mat-card-header>
                            <mat-card-header style="background-color: 	#00CED1;"
                                *ngIf="order?.order_status === 100 && order?.substitute_status === 'pending'">
                                <mat-card-title>{{order?.custom_order_id}} Subs.Out
                                </mat-card-title>
                            </mat-card-header>
                            <mat-card-header style="background-color: gray;"
                                *ngIf="order?.order_shipment.shipment_status === 'Shipped' && order?.order_status === 1">
                                <mat-card-title>{{order?.custom_order_id}} Shipped
                                </mat-card-title>
                            </mat-card-header>
                            <mat-card-header style="background-color: #00008B;"
                                *ngIf="order?.order_status === 100 && order?.substitute_status === 'done'">
                                <mat-card-title>{{order?.custom_order_id}} Subs.In
                                </mat-card-title>
                            </mat-card-header>
                            <mat-card-content>
                                <div>
                                    <strong>- Ordered On : </strong><br>
                                    <span>{{order?.order_activity?.activity_date | date : 'medium'}} </span><br>
                                    <span>{{order?.order_activity?.activity_date | datepipe}}</span>
                                </div>
                                <div>
                                    <strong>- Delivery Address : </strong><br>
                                    <span>{{order?.delivery_street_address}}, {{order?.delivery_state_name}} </span>
                                </div>
                                <div>
                                    <strong>- This order is assaign to : </strong><br>
                                    <span>{{order?.order_shipment?.created_by_name}}</span>
                                </div>
                                <div>
                                    <!-- <strong>Price : </strong><br> -->
                                    <strong>{{order?.gross_amount}} {{order?.currency_code}} </strong>
                                </div>
                                <div>
                                    <!-- <span>Payment status :</span><br> -->
                                    <strong>{{order?.payment_method_name}}</strong>
                                </div>
                            </mat-card-content>
                        </mat-card>
                    </div>
                </cdk-virtual-scroll-viewport>
            </div>
        </div>
    </div>
</div>