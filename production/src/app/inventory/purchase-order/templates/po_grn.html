<form #grnForm="ngForm" novalidate (ngSubmit)="grnForm.valid && addEditGrn(grnForm)">
<section class="right-part">
    <div class="topheading">
      <h1>Purchase Order GRN
      		<div class="btn-header">
			<button type="button" mat-raised-button class="btn-main" (click)="addEditGrn(grnForm)">Save</button>
          	<button type="button" mat-raised-button class="btn-line" (click)="_globalService.deleteTab(tabIndex,parentId)">Cancel</button>
		  	<label class="hidden-xs hidden-sm">Fields marked with <span>*</span> are compulsory</label>
	  	</div>
        <div class="clear"></div>
      </h1>
    </div>
    
	<div class="body-part">
			<div class="row same-height">
				<div class="col-md-6">
					<div class="box">
						<div class="heading">Purchase Order info</div>
						<ul class="box-list">
							<li>
								<div class="text-heading">Order Number</div>
								<div class="num-heading">{{purchase_order.purchase_order_id}}</div>
								<div class="clear"></div>
							</li>
							<li>
								<div class="text-heading">Order Date</div>
								<div class="num-heading">{{ purchase_order.order_date | date: 'shortDate' }}</div>
								<div class="clear"></div>
							</li>
							<li>
								<div class="text-heading">Order Status</div>
								<div class="num-heading">{{ purchase_order.status }}</div>
								<div class="clear"></div>
							</li>
							<li>
								<div class="text-heading">Receipt Number</div>
								<div class="num-heading">{{ purchase_order.received_id }}</div>
								<div class="clear"></div>
							</li>
							<li>
								<div class="text-heading">Received Date</div>
								<div class="num-heading">{{ purchase_order.received_date }}</div>
								<div class="clear"></div>
							</li>
							<li>
								<div class="text-heading">Placed from IP</div>
								<div class="num-heading">{{ purchase_order.ip_address }}</div>
								<div class="clear"></div>
							</li>
							<li>
								<div class="text-heading">Store Name</div>
								<div class="num-heading">{{ selected_warehouse.name }}</div>
								<div class="clear"></div>
							</li>
						</ul>
					</div>
				</div>
				<div class="col-md-6">
					<div class="box">
						<div class="heading">Vendor info</div>
						<ul class="box-list">
							<li>
								<div class="text-heading">Name</div>
								<div class="num-heading">{{ selected_supplier.name }}</div>
								<div class="clear"></div>
							</li>
							<li>
								<div class="text-heading">Phone Number</div>
								<div class="num-heading"> {{selected_supplier.phone}}</div>
								<div class="clear"></div>
							</li>
							<li>
								<div class="text-heading">Email</div>
								<div class="num-heading">{{selected_supplier.email}}</div>
								<div class="clear"></div>
							</li>
							<li>
								<div class="text-heading">Address</div>
								<div class="num-heading">
									{{ selected_supplier.company_name }} <br/>
									{{selected_supplier.address_one}} <br/>
									{{selected_supplier.address_two}} <br/>
									{{ selected_supplier.city }} {{ selected_supplier.zip }}
								</div>
								<div class="clear"></div>
							</li>
						</ul>
					</div>
				</div>
				
			
				<div class="col-md-6">
					<div class="box">
						<div class="heading">Ship to address</div>
						<ul class="box-list">
							<li>
								<div class="text-heading">Account Information</div>
								<div class="num-heading">
									{{selected_warehouse.contact_person}} <br/>
									{{ selected_warehouse.email }}
								</div>
								<div class="clear"></div>
							</li>
							<li>
								<div class="text-heading">Shiping Information</div>
								<div class="num-heading">
									{{ selected_warehouse.address }} <br/>
									{{ selected_warehouse.city }} {{ selected_warehouse.zipcode }}
								</div>
								<div class="clear"></div>
							</li>
						</ul>
					</div>
				</div>
				<div class="col-md-6">
					<div class="box">
						<div class="heading">Shiping method</div>
						<ul class="box-list">
							
							<li>
								<div class="text-heading">Shiping Option</div>
								<div class="num-heading">{{ (selected_ship.name)?selected_ship.name:' - ' }}</div>
								<div class="clear"></div>
							</li>
							<li>
								<div class="text-heading">Shiping Charge</div>
								<div class="num-heading">{{ purchase_order.shipping_cost }}</div>
								<div class="clear"></div>
							</li>
						</ul>
					</div>
				</div>
				<div class="col-md-6">
					<div class="box">
						<div class="heading">Payment method</div>
						<ul class="box-list">
							<li>
								<div class="text-heading">Payment method</div>
								<div class="num-heading">{{ selected_payment.name }}</div>
								<div class="clear"></div>
							</li>
						</ul>
					</div>
				</div>
				
			</div>

			<!-- new table -->
			<div class="heading">Review Your Order
					<div class="scanitm">
						<input type="text" placeholder="Scan Item" matInput name="scanItems" #scanItems="ngModel" [(ngModel)]="formModel.scanItems" (keyup.enter)="scanEAN()">
					</div>
			</div>
			<div class="table-list order purchace_order">
					<table cellspacing="0" cellpadding="0" >
							<thead>
								<tr>
									<th align="center" width="40"></th>
									<th align="center">SKU</th>
									<th align="center">Product Name</th>
									<th align="center">PO Qt</th>
									<th align="center">Remaining Qty</th>
									<th align="center">Item Information</th>
									<th align="center">Damaged Qty</th>
									<th align="center">Damage Reason </th>
									<th align="center"> Shortage Qty</th>
									<th align="center">CPU (INR)</th>
									<th align="center">Gross Amount (INR</th>
									<th align="center">Discount%</th>
									<th align="center">Net Amount (INR)</th>
								</tr>
							</thead>
							<tbody>
									<tr *ngFor="let item of purchase_order.products; let index = index;">
										<td align="center">	
											<mat-checkbox id="chk{{index}}" name="chk{{index}}"   [(ngModel)]="item.selected" [checked]="item.selected" disabled></mat-checkbox>
										</td>
										<td align="center">{{item.sku}}</td>
										<td align="center">{{item.name}}</td>
										<td align="center">{{item.quantity}}</td>
										<td align="center">{{item.remaining_quantity}}</td>
										<td align="center" style="padding:0;">
											<table cellpadding="0" cellspacing="0" class="innertable">
												<thead *ngIf="index == 0">
													<tr>
														<th>Received Qty</th>
														<th>Expiry Date</th>
														<th>Batch No</th>
														<th>Rack No</th>
														<th width="50" colspan="2"></th>
													</tr>
												</thead>
												<tbody>
													<tr *ngFor="let itemDetails of item.quantityDetails; let itemIndex = index">
														<td>
															<mat-form-field>
										      				<input type="number" min="0" matInput placeholder="" name="received_{{item.product_id}}_{{index}}_{{itemIndex}}" #received="ngModel" [(ngModel)]="itemDetails.receivedQuanity" (change)="calcQty(index,1)" validateMin="0">
										    				</mat-form-field>
														</td>
														<td>
															<mat-form-field>
														     <input type="text" matInput [matDatepicker]="picker" name="expiry_date_{{item.product_id}}_{{index}}_{{itemIndex}}" #expiry_date="ngModel" [(ngModel)]="itemDetails.expiry_date" (click)="picker.open()"> 
														       <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
														  		<mat-datepicker #picker></mat-datepicker>
														    </mat-form-field>
														</td>
														<td>
															<mat-form-field>
																<input type="text" matInput placeholder="" name="batchNo_{{item.product_id}}_{{index}}_{{itemIndex}}" #batchNo="ngModel" [(ngModel)]="itemDetails.batchNo">
															</mat-form-field>
														</td>
														<td><mat-form-field>
																<input type="text" matInput placeholder="" name="rack_no_{{item.product_id}}_{{index}}_{{itemIndex}}" #rack_no="ngModel" [(ngModel)]="itemDetails.rack_no">
															</mat-form-field>
														</td>
														<td> <mat-checkbox id="activeBatch_{{item.product_id}}_{{index}}_{{itemIndex}}" name="activeBatch_{{item.product_id}}_{{index}}_{{itemIndex}}"  [(ngModel)]="itemDetails.checked" (change)="ActivateRowItems(index,itemIndex,item.quantityDetails)" title="Scan item in this batch"></mat-checkbox> </td>
														<td class="iconround">
															<a href="javascript:void(0);" (click)="addMoreBatches(index,itemIndex)" *ngIf="(itemIndex+1) == item.quantityDetails.length" title="Add More Batch/Expiry">+</a>

															<a href="javascript:void(0);" class=" del" (click)="removeBatch(index,itemIndex)" *ngIf="(itemIndex+1) != item.quantityDetails.length" title="Remove Batch/Expiry">X</a>
														</td>
													</tr>
												</tbody>
											</table>
										</td>
										<td align="center">
											<mat-form-field>
												<input type="number" min="0" matInput placeholder="" name="damaged{{index}}" #damaged="ngModel" [(ngModel)]="item.damaged_quantity" (change)="calcQty(index,2)" validateMin="0">
											</mat-form-field>
										</td>
										<td align="center">
											<mat-form-field>
												<input type="text"  matInput placeholder="" name="damageReason{{index}}" #damageReason="ngModel" [(ngModel)]="item.damageReason">
											</mat-form-field>
										</td>
										<td align="center">
											<mat-form-field>
												<input type="number" min="0" matInput placeholder="" name="shortage{{index}}" #shortage="ngModel" [(ngModel)]="item.shortage_quantity" (change)="calcQty(index,3)" validateMin="0">
											</mat-form-field>
										</td>
										<td align="center">{{item.price | number: '1.2-2'}}</td>
										<td align="center">{{item.gross_amt | number: '1.2-2'}}</td>
										<td align="center">{{item.discount | number: '1.2-2'}}</td>
										<td align="center">{{item.net_amt | number: '1.2-2'}}</td>
									</tr>
								<tr>
									<td colspan="10"></td>
									<td colspan="3">
										<table class="price">
											<tr>
												<td>Subtotal {{(supplier_currency.currency)?'('+supplier_currency.currency+')':''}}: </td>
												<td>{{purchase_order.gross_amount | number: '1.2-2'}}</td>
											</tr>
											<tr>
												<td>Shipping Cost {{(supplier_currency.currency)?'('+supplier_currency.currency+')':''}}: </td>
												<td>{{ purchase_order.shipping_cost | number: '1.2-2' }}</td>
											</tr>
											<tr>
												<td>Tax {{(supplier_currency.currency)?'('+supplier_currency.currency+')':''}}: </td>
												<td>
													{{ purchase_order.purchase_order_tax | number: '1.2-2' }}
												</td>
											</tr>
											<tr>
												<td>Discount {{(supplier_currency.currency)?'('+supplier_currency.currency+')':''}}: </td>
												<td>
													{{ purchase_order.discount_amount | number: '1.2-2' }}
												</td>
											</tr>
											<tr class="total">
												<td>Grand Total {{(supplier_currency.currency)?'('+supplier_currency.currency+')':''}}: </td>
												<td>{{ purchase_order.net_amount | number: '1.2-2' }}</td>
											</tr>
										</table>
									</td>
								</tr>
							</tbody>
						</table>
						
			</div>
			<!-- new table end -->

						
    </div>
    <div class="clear"></div>    
</section>
</form>


